@model IEnumerable<EvidencijaAvioKarata.Models.Destinacija>
@{
    ViewBag.Title = "Destinacije";
}

<div class="custom-container">
    <h2>Destinacije</h2>

    <table id="destinacije" class="table table-bordered">
        <thead>
            <tr>
                <th>Naziv</th>
                <th>Ime aerodroma</th>
                <th>Grad</th>
                <th>Obriši</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    @Html.ActionLink("Dodaj destinaciju", "DodajDestinaciju", "Destinacije", new { @class = "btn btn-danger" })
</div>
@section scripts
{
    <script>
        $(document).ready(function () {
            var table = $("#destinacije").DataTable({
                //Ajax sluzi za pozivanje API-a
                ajax: {
                    url: "/api/destinacije/",
                    method: "GET",
                    dataSrc: ""
                },
                //Vraca sve kolone u tabeli sa vrednostima
                columns: [
                    {
                        data: "naziv",
                        render: function (data, type, destinacija) {
                            return "<a href='/destinacije/destinacijaForma/" + destinacija.id + "'>" + destinacija.naziv + "</a>";
                        }
                    },
                    {
                        data: "imeAerodroma"
                    },
                    {
                        data: "grad"
                    },
                    {
                        data: "id",
                        render: function (data) {
                            return "<button class='btn-link js-delete' data-destinacija-id=" + data + ">Obrisi</button>";
                        }
                    }
                ]
            });


            //Kreiranje dugmeta za brisanje - daje mu klasu .js-delete, i na klik brise odredjeno mesto
            $("#destinacije").on("click", ".js-delete", function () {
                var button = $(this);
                //AlertBox za potvrdu brisanja
                bootbox.confirm("Da li ste sigurni da zelite da obrišete ovu destinaciju?", function (result) {
                    if (result) {
                        $.ajax({
                            url: "/api/destinacije/" + button.attr("data-destinacija-id"),
                            method: "DELETE",
                            success: function () {
                                table.row(button.parents("tr")).remove().draw();
                            }
                        })
                    }
                })
            })
        });
    </script>
}

